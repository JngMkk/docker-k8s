# 4장 쿠버네티스를 이루는 컨테이너 도우미, 도커

## 2. 도커로 컨테이너 다루기

### 3) 컨테이너 내부 파일 변경하기

- docker cp

  ```
  docker cp <호스트 경로> <컨테이너 이름>:<컨테이너 내부 경로>
  형식으로 호스트에 위치한 파일을 구동 중인 컨테이너 내부에 복사.
  따라서 컨테이너에 임시로 필요한 파일이 있는 경우 단편적으로 전송하기 위해서 사용.
  또는 컨테이너에 저장돼 있는 설정 및 로그를 추출해 확인하는 목적으로도 사용.
  ```

- Dockerfile ADD

  ```
  이미지는 Dockerfile을 기반으로 만들어지는데, 이때 Dockerfile에 ADD라는 구문으로 컨테이너 내부로 복사할 파일을 지정하면
  이미지를 빌드할 때 지정한 파일이 이미지 내부로 복사됨.
  이후 해당 이미지를 기반으로 구동한 컨테이너에서는 복사한 파일을 사용할 수 있음.
  그러나 사용자가 원하는 파일을 선택해 사용할 수 없다는 약점이 존재
  ```

- 바인드 마운트

  ```
  호스트의 파일 시스템과 컨테이너 내부를 연결해 어느 한쪽에서 작업한 내용이 양쪽에 동시에 반영되는 방법.
  새로운 컨테이너를 구동할 때도 호스트와 연결할 파일이나 디렉터리의 경로만 지정하면
  다른 컨테이너에 있는 파일을 새로 생성한 컨테이너와 연결할 수 있음.
  데이터베이스의 데이터 디렉터리나 서버의 첨부 파일 디렉터리처럼 컨테이너가 바뀌어도 없어지면 안되는 자료 보존 가능
  ```

  ```
  docker run -d -p 8080:80 \
  -v /root/html:/usr/share/nginx/html --restart always --name nginx-bind-mounts nginx
  ```

- 볼륨

  ```
  호스트의 특정 디렉터리가 아닌 도커가 관리하는 볼륨을 컨테이너와 연결.
  따라서 도커가 관리하는 불륨 공간을 NFS와 같은 공유 디렉터리에 생성한다면
  다른 호스트에서도 도커가 관리하는 볼륨을 함께 사용할 수 있음.
  ```
  
  - 볼륨 생성
  
    ```
    docker volume create nginx-volume
    ```
  
  - 볼륨 조회
  
    ```
    docker volume inspect nginx-volume
    
    "Mountpoint": "/var/lib/docker/volumes/nginx-volume/_data"
    ```
  
  - 연결
  
    ```
    docker run -d -v nginx-volume:/usr/share/nginx/html \
    -p 8081:80 --restart always --name nginx-volume nginx
    ```

| 구분           | docker cp     | Dockerfile ADD               | 바인드 마운트         | 볼륨                     |
| -------------- | ------------- | ---------------------------- | --------------------- | ------------------------ |
| 컨테이너 적용  | 구동 중 복사  | 이미지 생성 시 복사          | 구동 시 디렉터리 연결 | 구동 시 도커의 볼륨 연결 |
| 파일 보관 위치 | 컨테이너 내부 | 컨테이너 내부                | 호스트(디렉터리)      | 호스트(도커 볼륨)        |
| 주 활용 용도   | 임시 파일     | 컨테이너 생성 시 필요한 파일 | 보존이 필요한 파일    | 보존이 필요한 파일       |
| 관리 편의성    | 좋지 못함     | 좋음                         | 좋음                  | 매우 좋음                |
| 파일 보존성    | 좋지 못함     | 좋음                         | 매우 좋음             | 매우 좋음                |

