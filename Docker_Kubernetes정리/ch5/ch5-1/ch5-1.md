# 5장 지속적 통합과 배포 자동화, 젠킨스

## 1. 컨테이너 인프라 환경에서 CI/CD

```
CI는 코드를 커밋하고 빌들했을 때 정상적으로 작동하는지 반복적으로 검증해 애플리케이션의 신뢰성을 높이는 작업.
CI 과정을 마친 애플리케이션은 신뢰할 수 있는 상태가 됨.
CD는 CI 과정에서 생성된 신뢰할 수 있는 애플리케이션을 실제 상용 환경에 자동으로 배포하는 것을 의미함.
애플리케이션을 상용 환경에 배포할 때 고려해야 할 사항이 여러 가지 있는데,
이를 CD에 미리 정의하면 실수를 줄이고, 실제 적용 시간도 최소화할 수 있음.
```

### 1) CI/CD 도구 비교

- 팀시티

  ```
  코틀린 기반으로 만든 Kotlin DSL이라는 스크립트 언어로 작업을 구성할 수 있음.
  빌드 작업을 수행하는 에이전트 3개와 빌드 작업 100개를 무료로 사용할 수 있고,
  더 많은 에이전트를 사용하려면 유료 결제 필요
  ```

- 깃허브 액션

  ```
  깃허브에서 지원하는 워크플로 기반의 CI/CD 도구.
  깃허브에 저장한 소스 코드를 자동 분석한 결과를 기반으로 깃허브 액션이 추천하는 방식에 따라
  워크플로를 구성하거나 사용자가 직접 워크플로를 정의하는 파일을 작성한 후 깃허브 저장소에 넣어 사용할 수 있음.
  깃허브 저장소에 소스 코드를 공개할 경우 깃허브 액션을 무료로 사용할 수 있으나 한 달에 2000분이라는 제한 시간이 있음.
  추가로 사용할 경우 분 단위의 요금이 별도로 부과됨.
  ```

- 뱀부

  ```
  유료. 사용자의 서버에 설치해 사용.
  아틀라시안에서 만든 다른 협업 도구를 사용 중이라면 연계해 사용하기 좋음
  ```

- 젠킨스

  ```
  오픈 소스 CI/CD 도구.
  사용자가 직접 UI에서 작업을 구성하거나 작업 순서를 코드로 정의할 수 있음.
  많은 사람들이 사용하고 있어서 사용에 필요한 정보를 찾기 쉽고 활용 방법과 플러그인 개발 관련 커뮤니티 활동이 활발해서
  다양한 사용 환경, 언어 및 빌드 도구와 연계할 플러그인이 필요할 경우 인터넷에서 대부분의 플러그인을 쉽게 찾을 수 있음.
  특정 언어나 환경에 구애받지 않고 범용적인 목적으로 무난하게 사용 가능.
  ```

| 구분      | 팀시티    | 깃허브 액션 | 뱀부      | 젠킨스    |
| --------- | --------- | ----------- | --------- | --------- |
| 설치 방식 | 직접 설치 | 깃허브 연동 | 직접 설치 | 직접 설치 |
| 연계 기능 | 보통      | 보통        | 부족      | 매우 많음 |
| 가격      | 무료/유료 | 무료/유료   | 유료      | 무료      |
| 기능 추가 | 보통      | 매우 다양   | 보통      | 매우 다양 |
| 범용성    | 보통      | 매우 큼     | 보통      | 매우 큼   |
| 정보량    | 부족함    | 많음        | 많음      | 매우 많음 |

```
이외에도 퍼블릭 클라우드 기반의 시스템일 때는 클라우드 서비스 제공 업체에서 배포하는 CI/CD 도구를,
배포가 중요한 환경에서는 CD 기능에 중점을 둔 스핀네이커나 아르고 CD를 선택적으로 도입할 수 있음.

젠킨스는 거의 모든 환경에 사용할 수 있도록 다양한 플러그인을 추가해 원하는 형태를 만드는 블록 방식으로 구성돼 있음.
```



### 2) 젠킨스로 쿠버네티스 운영 환경 개선하기

```
애플리케이션 배포 영역에 쿠버네티스를 사용하면 개발자는 애플리케이션 개발에만 집중할 수 있게 됨.
기존에는 환경이 다른 곳에 빌드한 애플리케이션을 배포하게 되면 개발자가 개별 환경에 맞춰 애플리케이션 코드를 일일이 수정해야 했음.
하지만 모든 배포 환경을 컨테이너 인프라로 일원화하고, CI/CD 도구를 사용하면 애플리케이션에 맞는 환경을 적용해 자동으로 배포 가능.
통합 과정에서 만들어진 컨테이너 이미지를 기반으로 쿠버네티스가 존재하는 어떤 환경에서도 일관성 있는 애플리케이션 배포 가능.

개발자가 작성한 애플리케이션 코드를 소스 코드 저장소에 푸시하면,
쿠버네티스 내부에 설치된 젠킨스는 애플리케이션 코드를 빌드하고 레지스트리에 푸시한 후에 쿠버네티스에서 사용 가능한 형태로 배포함.
젠킨스는 작업 내용을 아이템 단위로 정의하고 조건에 따라 자동으로 작업을 수행해 효율을 높이고 실수를 줄임.

컨테이너 인프라 환경에서 젠킨스를 사용하는 주된 이유는 애플리케이션을 컨테이너로 만들고 배포하는 과정을 자동화하기 위함임.
하지만 자동화 환경은 단순히 젠킨스용 파드만을 배포해서는 만들어지지 않음.
젠킨스는 컨트롤러와 에이전트 형태로 구성한 다음 배포해야 하며 여기에 필요한 설정을 모두 넣어야 함.
애플리케이션을 배포하기 위한 환경을 하나하나 구성하는 것은 매우 복잡하고 번거로운 일이며,
고정된 값이 아니기 때문에 매니페스트로 작성해 그대로 사용할 수 없음. 구성 환경에 따라 많은 부분을 동적으로 변경해야 함.

동적인 변경 사항을 간편하고 빠르게 적용할 수 있도록 도와주는 도구 중 하나는 커스터마이즈이고 다른 하나는 헬름.
```

